import{Gb as S,I as d,L as h,U as H,i as g,t as c,u as m,yb as E,zb as v}from"./chunk-XSD7VU42.js";var f=class s{constructor(e,t,r){this.httpClient=e;this.injector=t;this.notificationService=r}refreshToken(){return this.httpClient.post(this.injector.get(u).urlBase+this.injector.get(u).urlApiVersion+"/user/public/auth/refreshToken",{},{withCredentials:!0})}genericError(e){let t=`Error ${e.status}: ${e.message}. Termina la ejecuci\xF3n.`;return console.error(t),this.notificationService.showError(e.status.toString()),g(()=>new Error(t))}handleHttpError(e,t,r=!0){return e.status===401?(console.warn("Error 401 interceptado. Iniciando proceso de reautenticaci\xF3n..."),this.refreshToken().pipe(m(()=>(console.log("Token actualizado con \xE9xito. Reintentando la petici\xF3n original..."),t)),c(i=>(console.error("El reintento o el refresh token fallaron. Finalizando."),r?this.genericError(i):g(()=>new Error(i)))))):(console.error(e.message),r?this.genericError(e):g(()=>new Error(e.message)))}static \u0275fac=function(t){return new(t||s)(h(v),h(H),h(S))};static \u0275prov=d({token:s,factory:s.\u0275fac,providedIn:"root"})};var u=class s{constructor(e,t){this.httpClient=e;this.handlerService=t}urlBase="https://s5-ceatic.ujaen.es";urlApiVersion="/test/api/v1";getFullUrl(e){return this.urlBase+this.urlApiVersion+e}getHeaders(e,t){let r=new E;return e&&(r=r.set("Content-Type",e)),t&&Object.keys(t).forEach(i=>{r=r.set(i,t[i])}),r}httpGet(e,t=!1,r=!0,i,a){let l=this.getFullUrl(e),p=this.getHeaders(i,a),n=()=>this.httpClient.get(l,{headers:p,withCredentials:t});return n().pipe(c(o=>this.handlerService.handleHttpError(o,n(),r)))}httpPost(e,t,r=!0,i=!0,a,l){let p=this.getFullUrl(e),n=this.getHeaders(a,l),o=()=>this.httpClient.post(p,t,{headers:n,withCredentials:r});return o().pipe(c(b=>this.handlerService.handleHttpError(b,o(),i)))}httpDelete(e,t=!0,r=!0,i,a){let l=this.getFullUrl(e),p=this.getHeaders(i,a),n=()=>this.httpClient.delete(l,{headers:p,withCredentials:t});return n().pipe(c(o=>this.handlerService.handleHttpError(o,n(),r)))}httpPut(e,t,r=!0,i=!0,a,l){let p=this.getFullUrl(e),n=this.getHeaders(a,l),o=()=>this.httpClient.put(p,t,{headers:n,withCredentials:r});return o().pipe(c(b=>this.handlerService.handleHttpError(b,o(),i)))}static \u0275fac=function(t){return new(t||s)(h(v),h(f))};static \u0275prov=d({token:s,factory:s.\u0275fac,providedIn:"root"})};export{u as a};
